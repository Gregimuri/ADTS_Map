<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ | –ì–µ–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</title>
    
    <!-- Meta —Ç–µ–≥–∏ –¥–ª—è SEO -->
    <meta name="description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫ —Å —É–º–Ω—ã–º –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π">
    <meta name="keywords" content="–∫–∞—Ä—Ç–∞, —Ç–æ—Ä–≥–æ–≤—ã–µ —Ç–æ—á–∫–∏, –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞">
    <meta name="author" content="TT Map System">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
          crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" 
          integrity="sha256-mpPm7zLpZ4Rv0L+QcR6H1rJz7N4p6HpJjQyH4J9/2HY=" 
          crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" 
          integrity="sha256-x8W4DcqFKd5p3ltkULqMGNi8b1c6pL75f2p1b8Zz1kM=" 
          crossorigin="anonymous" />
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
          integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üó∫Ô∏è</text></svg>">
    
    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è Leaflet -->
    <style>
        /* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ */
        .marker-cluster-small {
            background-color: rgba(46, 204, 113, 0.6);
        }
        .marker-cluster-small div {
            background-color: rgba(46, 204, 113, 0.8);
        }

        .marker-cluster-medium {
            background-color: rgba(52, 152, 219, 0.6);
        }
        .marker-cluster-medium div {
            background-color: rgba(52, 152, 219, 0.8);
        }

        .marker-cluster-large {
            background-color: rgba(231, 76, 60, 0.6);
        }
        .marker-cluster-large div {
            background-color: rgba(231, 76, 60, 0.8);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .leaflet-popup-content {
            margin: 15px;
            line-height: 1.4;
        }
        
        .leaflet-popup-tip {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –∫–∞—Ä—Ç—ã */
        .leaflet-control-zoom a {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .leaflet-control-zoom a:hover {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä –¥–ª—è –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è */
        #geocoding-progress {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            border-left: 4px solid #3498db;
            min-width: 300px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        #geocoding-progress h5 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .progress-container {
            width: 100%;
            height: 6px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #3498db);
            border-radius: 3px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg,
                rgba(255, 255, 255, 0.2) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.2) 50%,
                rgba(255, 255, 255, 0.2) 75%,
                transparent 75%,
                transparent
            );
            z-index: 1;
            background-size: 50px 50px;
            animation: move 2s linear infinite;
        }
        
        @keyframes move {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: 50px 50px;
            }
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .progress-stats {
            font-size: 11px;
            color: #95a5a6;
            margin-top: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
        .progress-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #95a5a6;
            cursor: pointer;
            font-size: 16px;
            transition: color 0.3s;
        }
        
        .progress-close:hover {
            color: #e74c3c;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container">
        <!-- –°–∞–π–¥–±–∞—Ä -->
        <aside class="sidebar">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å -->
            <header class="header">
                <h1><i class="fas fa-map-marked-alt"></i> –ö–∞—Ä—Ç–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫</h1>
                <div class="status" id="status">
                    <i class="fas fa-sync-alt fa-spin"></i> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã...
                </div>
            </header>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <section class="stats">
                <article class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);">
                        <i class="fas fa-store"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="total-points">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —Ç–æ—á–µ–∫</div>
                    </div>
                </article>
                
                <article class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-value" id="shown-points">0</div>
                        <div class="stat-label">–ü–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–µ</div>
                    </div>
                </article>
            </section>
            
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∫–Ω–æ–ø–∫–∏ -->
            <section class="controls">
                <button class="btn btn-primary" onclick="loadData()" id="refresh-btn">
                    <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </button>
                <button class="btn btn-secondary" onclick="clearFilters()">
                    <i class="fas fa-filter"></i> –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                </button>
            </section>
            
            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º -->
            <section class="geocoding-controls">
                <h4><i class="fas fa-map-marker-alt"></i> –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
                <div class="geocoding-buttons">
                    <button class="btn btn-success" onclick="startManualGeocoding()" id="geocode-btn">
                        <i class="fas fa-search-location"></i> –ù–∞–π—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    </button>
                    <button class="btn btn-warning" onclick="stopGeocoding()" id="stop-geocode-btn" disabled>
                        <i class="fas fa-stop-circle"></i> –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                    </button>
                    <button class="btn btn-info" onclick="showGeocodingStats()">
                        <i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </button>
                </div>
            </section>
            
            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <section class="filters">
                <h3><i class="fas fa-filter"></i> –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ—á–µ–∫</h3>
                
                <div class="filter-group">
                    <label><i class="fas fa-project-diagram"></i> –ü—Ä–æ–µ–∫—Ç:</label>
                    <select id="filter-project" multiple class="filter-select">
                        <option value="">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label><i class="fas fa-globe-europe"></i> –†–µ–≥–∏–æ–Ω:</label>
                    <select id="filter-region" multiple class="filter-select">
                        <option value="">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label><i class="fas fa-info-circle"></i> –°—Ç–∞—Ç—É—Å:</label>
                    <select id="filter-status" multiple class="filter-select">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label><i class="fas fa-user-tie"></i> –ú–µ–Ω–µ–¥–∂–µ—Ä:</label>
                    <select id="filter-manager" multiple class="filter-select">
                        <option value="">–í—Å–µ –º–µ–Ω–µ–¥–∂–µ—Ä—ã</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="applyFilters()" style="margin-top: 20px;">
                    <i class="fas fa-check"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                </button>
            </section>
            
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–æ—á–∫–µ -->
            <section class="point-info" id="point-info">
                <h4><i class="fas fa-info-circle"></i> –î–µ—Ç–∞–ª–∏ —Ç–æ—á–∫–∏</h4>
                <div id="point-details">
                    <div style="text-align: center; padding: 20px; color: rgba(255, 255, 255, 0.7);">
                        <i class="fas fa-mouse-pointer fa-2x" style="margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–æ—á–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ<br>–¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏</p>
                    </div>
                </div>
            </section>
            
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
            <footer style="padding: 20px; text-align: center; color: rgba(255, 255, 255, 0.5); font-size: 12px; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: auto;">
                <p>
                    <i class="fas fa-cogs"></i> –°–∏—Å—Ç–µ–º–∞ –≥–µ–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ v2.0<br>
                    <small>–£–º–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Ä¢ –Ø–Ω–¥–µ–∫—Å ‚Üí OSM ‚Ä¢ –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</small>
                </p>
            </footer>
        </aside>
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Å –∫–∞—Ä—Ç–æ–π -->
        <main class="map-container">
            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç—ã -->
            <div id="map"></div>
            
            <!-- –ü–∞–Ω–µ–ª—å –ø–æ–∏—Å–∫–∞ -->
            <div class="search-box">
                <input type="text" 
                       id="search" 
                       placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–¥—Ä–µ—Å—É –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—É..." 
                       onkeypress="if(event.key === 'Enter') searchPoints()">
                <button onclick="searchPoints()" title="–ù–∞–π—Ç–∏ –Ω–∞ –∫–∞—Ä—Ç–µ">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <!-- –õ–µ–≥–µ–Ω–¥–∞ –∫–∞—Ä—Ç—ã -->
            <div class="legend">
                <h5><i class="fas fa-key"></i> –õ–µ–≥–µ–Ω–¥–∞ –∫–∞—Ä—Ç—ã</h5>
                <div id="legend">
                    <div style="text-align: center; color: #7f8c8d; font-size: 13px; margin: 10px 0;">
                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –ª–µ–≥–µ–Ω–¥—ã...
                    </div>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; font-size: 11px; color: #95a5a6;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #ffcc00; border: 2px solid white;"></div>
                        <span>–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #7bc96f; border: 2px solid white;"></div>
                        <span>OpenStreetMap</span>
                    </div>
                </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –æ–±–∑–æ—Ä—É -->
            <button id="reset-view-btn" 
                    style="display: none; position: absolute; bottom: 25px; right: 25px; z-index: 1000; 
                           background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; 
                           border: none; padding: 12px 15px; border-radius: 10px; cursor: pointer; 
                           box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4); transition: all 0.3s;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(52, 152, 219, 0.6)'"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(52, 152, 219, 0.4)'"
                    onclick="resetMapView()">
                <i class="fas fa-globe-europe"></i> –í–µ—Å—å —Ä–µ–≥–∏–æ–Ω
            </button>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">–ó–∞–≥—Ä—É–∑–∫–∞</h3>
            <p id="modal-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
            <div class="progress-container" style="margin: 20px 0;">
                <div class="progress-bar-fill" id="modal-progress" style="width: 0%;"></div>
            </div>
            <button class="btn btn-primary" onclick="closeModal()" id="modal-ok-btn" style="display: none;">
                <i class="fas fa-check"></i> OK
            </button>
        </div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="geocoding-progress" class="fade-in">
        <button class="progress-close" onclick="hideGeocodingProgress()">
            <i class="fas fa-times"></i>
        </button>
        <h5>
            <i class="fas fa-search-location fa-spin"></i>
            –§–æ–Ω–æ–≤–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
        </h5>
        <div class="progress-container">
            <div class="progress-fill" id="geocoding-progress-fill" style="width: 0%;"></div>
        </div>
        <div class="progress-text">
            <span id="geocoding-processed">0</span>
            <span id="geocoding-total">0</span>
        </div>
        <div class="progress-stats">
            <span id="geocoding-yandex">–Ø–Ω–¥–µ–∫—Å: 0</span>
            <span id="geocoding-osm">OSM: 0</span>
            <span id="geocoding-cache">–ö—ç—à: 0</span>
        </div>
    </div>

    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ JavaScript -->
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"
            integrity="sha256-mN1B0Z7qH6HkLVvZ6pLrH5Hv5OksX48QzKQr3aB1pkc="
            crossorigin="anonymous"></script>
    
    <!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è -->
    <script src="config.js"></script>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <script src="app.js"></script>
    
    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UI -->
    <script>
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—É–ª—Ç–∏–ø–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫
            initTooltips();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            setupEventListeners();
            
            // –ü–æ–∫–∞–∑ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏
            showLoadTime();
        });
        
        function initTooltips() {
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç—É–ª—Ç–∏–ø—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                const title = btn.getAttribute('title') || btn.textContent.trim();
                if (title) {
                    btn.setAttribute('data-tooltip', title);
                }
            });
            
            // –°–æ–∑–¥–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —Ç—É–ª—Ç–∏–ø–æ–≤
            const style = document.createElement('style');
            style.textContent = `
                [data-tooltip] {
                    position: relative;
                }
                [data-tooltip]:hover::after {
                    content: attr(data-tooltip);
                    position: absolute;
                    bottom: 100%;
                    left: 50%;
                    transform: translateX(-50%);
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 5px 10px;
                    border-radius: 4px;
                    font-size: 12px;
                    white-space: nowrap;
                    z-index: 10000;
                    margin-bottom: 5px;
                    pointer-events: none;
                    animation: fadeIn 0.2s ease-out;
                }
                [data-tooltip]:hover::before {
                    content: '';
                    position: absolute;
                    bottom: 100%;
                    left: 50%;
                    transform: translateX(-50%);
                    border: 5px solid transparent;
                    border-top-color: rgba(0, 0, 0, 0.8);
                    margin-bottom: -5px;
                    z-index: 10001;
                    pointer-events: none;
                }
            `;
            document.head.appendChild(style);
        }
        
        function setupEventListeners() {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Escape –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('modal');
                    if (modal.style.display === 'flex') {
                        closeModal();
                    }
                    const progress = document.getElementById('geocoding-progress');
                    if (progress.style.display === 'block') {
                        hideGeocodingProgress();
                    }
                }
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
            const searchInput = document.getElementById('search');
            searchInput.addEventListener('focus', function() {
                this.select();
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–æ–π–Ω–æ–≥–æ –∫–ª–∏–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
            const mapContainer = document.getElementById('map');
            mapContainer.addEventListener('dblclick', function(e) {
                if (e.target === this) {
                    resetMapView();
                }
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', function() {
                updateStatus('–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω');
                setTimeout(() => {
                    updateStatus('–ì–æ—Ç–æ–≤–æ');
                }, 1000);
            });
        }
        
        function showLoadTime() {
            const loadTime = performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart;
            console.log(`–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ${loadTime}ms`);
            
            if (loadTime > 1000) {
                setTimeout(() => {
                    showNotification(`–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∑–∞ ${loadTime}–º—Å`, 'info');
                }, 500);
            }
        }
        
        function resetMapView() {
            if (window.map) {
                const allPoints = window.allPoints || [];
                const pointsWithCoords = allPoints.filter(p => p.lat && p.lng);
                
                if (pointsWithCoords.length > 0) {
                    const bounds = L.latLngBounds(
                        pointsWithCoords.map(p => [p.lat, p.lng])
                    );
                    
                    if (bounds.isValid()) {
                        map.fitBounds(bounds, { 
                            padding: [50, 50], 
                            maxZoom: 10,
                            animate: true,
                            duration: 1
                        });
                        
                        showNotification('–ö–∞—Ä—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –∫ –æ–±—â–µ–º—É –≤–∏–¥—É', 'success');
                    }
                } else {
                    map.setView(CONFIG.MAP.center, CONFIG.MAP.zoom, {
                        animate: true,
                        duration: 1
                    });
                }
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                const resetBtn = document.getElementById('reset-view-btn');
                resetBtn.style.display = 'none';
            }
        }
        
        function hideGeocodingProgress() {
            const progress = document.getElementById('geocoding-progress');
            progress.style.display = 'none';
            showNotification('–ü–∞–Ω–µ–ª—å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–∫—Ä—ã—Ç–∞', 'info');
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
        window.resetMapView = resetMapView;
        window.hideGeocodingProgress = hideGeocodingProgress;
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
        window.updateGeocodingProgress = function(processed, total, yandex, osm, cache) {
            const progress = document.getElementById('geocoding-progress');
            const fill = document.getElementById('geocoding-progress-fill');
            const processedEl = document.getElementById('geocoding-processed');
            const totalEl = document.getElementById('geocoding-total');
            const yandexEl = document.getElementById('geocoding-yandex');
            const osmEl = document.getElementById('geocoding-osm');
            const cacheEl = document.getElementById('geocoding-cache');
            
            if (progress && fill && processedEl && totalEl) {
                progress.style.display = 'block';
                const percentage = total > 0 ? (processed / total) * 100 : 0;
                fill.style.width = percentage + '%';
                processedEl.textContent = `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${processed}`;
                totalEl.textContent = `–í—Å–µ–≥–æ: ${total}`;
                
                if (yandexEl) yandexEl.textContent = `–Ø–Ω–¥–µ–∫—Å: ${yandex || 0}`;
                if (osmEl) osmEl.textContent = `OSM: ${osm || 0}`;
                if (cacheEl) cacheEl.textContent = `–ö—ç—à: ${cache || 0}`;
            }
        };
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
        window.updateGeocodingButtons = function(isRunning) {
            const geocodeBtn = document.getElementById('geocode-btn');
            const stopBtn = document.getElementById('stop-geocode-btn');
            
            if (geocodeBtn && stopBtn) {
                if (isRunning) {
                    geocodeBtn.disabled = true;
                    stopBtn.disabled = false;
                    geocodeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –í –ø—Ä–æ—Ü–µ—Å—Å–µ...';
                } else {
                    geocodeBtn.disabled = false;
                    stopBtn.disabled = true;
                    geocodeBtn.innerHTML = '<i class="fas fa-search-location"></i> –ù–∞–π—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã';
                }
            }
        };
        
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–æ—Å–∞ –≤–∏–¥–∞
        window.toggleResetViewButton = function(show) {
            const resetBtn = document.getElementById('reset-view-btn');
            if (resetBtn) {
                resetBtn.style.display = show ? 'block' : 'none';
            }
        };
    </script>
</body>
</html>
